import{x as m,z as p,y as u,m as d,B as f,b as i,D as l,n as D,d as g,l as y,k as c,g as w}from"./index-CrkXj5Pf.js";async function A(a,s){const t=d(i,"conversations"),e=m(t,u("participants","array-contains",a.uid)),n=(await l(e)).docs.find(v=>v.data().participants.includes(s.uid));if(n)return{id:n.id,...n.data()};const r={participants:[a.uid,s.uid],participantData:{[a.uid]:{name:a.displayName||"Anonymous",photoURL:a.photoURL||null},[s.uid]:{name:s.displayName||s.name||"Anonymous",photoURL:s.photoURL||null}},lastMessage:null,createdAt:c(),updatedAt:c()};return{id:(await y(t,r)).id,...r}}function L(a,s){const t=m(d(i,"conversations"),u("participants","array-contains",a),p("updatedAt","desc"));return f(t,e=>{const o=e.docs.map(n=>({id:n.id,...n.data()}));s(o)},e=>{console.error("Error subscribing to conversations:",e),s([])})}function C(a,s){const t=m(d(i,"conversations",a,"messages"),p("timestamp","asc"));return f(t,e=>{const o=e.docs.map(n=>({id:n.id,...n.data()}));s(o)},e=>{console.error("Error subscribing to messages:",e),s([])})}async function M(a,s,t){if(!t.trim())return null;const e=d(i,"conversations",a,"messages"),o=g(i,"conversations",a),n={senderId:s,text:t.trim(),timestamp:c(),read:!1},r=await y(e,n);return await D(o,{lastMessage:{text:t.trim().substring(0,100),senderId:s,timestamp:c()},updatedAt:c()}),{id:r.id,...n}}async function q(a,s){const t=d(i,"conversations",a,"messages"),e=m(t,u("read","==",!1),u("senderId","!=",s));try{const n=(await l(e)).docs.map(r=>D(g(t,r.id),{read:!0}));await Promise.all(n)}catch(o){console.error("Error marking messages as read:",o)}}async function S(a){const s=g(i,"conversations",a),t=await w(s);return t.exists()?{id:t.id,...t.data()}:null}function T(a){if(!a)return"";const s=a.toDate?a.toDate():new Date(a),t=new Date,e=t-s;if(e<1440*60*1e3&&s.getDate()===t.getDate())return s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const o=new Date(t);return o.setDate(o.getDate()-1),s.getDate()===o.getDate()?"Yesterday":e<10080*60*1e3?s.toLocaleDateString([],{weekday:"short"}):s.toLocaleDateString([],{month:"short",day:"numeric"})}export{C as a,S as b,M as c,T as f,A as g,q as m,L as s};
