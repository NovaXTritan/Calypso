import{c as L,a as T,r as a,x as A,m as E,b as h,y as q,C as $,D as o,j as e,E as U,l as J,F as O,d as W}from"./index-CB_rz54d.js";import{C as z}from"./circle-alert-CYfwvB7e.js";import{T as _}from"./trash-2--Llh0xk3.js";const H=L("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),M=["Calm","Focused","Stressed","Anxious","Happy","Tired"];function Y(){const{currentUser:i}=T(),[d,g]=a.useState(""),[p,C]=a.useState("Calm"),[b,f]=a.useState(""),[m,D]=a.useState([]),[x,F]=a.useState(""),[j,N]=a.useState(!1),[y,w]=a.useState(null),[v,n]=a.useState("");a.useEffect(()=>{u()},[i]);async function u(){if(!i){n("No currentUser - user not logged in");return}n(`Fetching entries for user: ${i.uid}`);try{const s=A(E(h,"journal_entries"),q("userId","==",i.uid)),t=await $(s);n(`Found ${t.docs.length} documents`);const r=t.docs.map(l=>{const c=l.data();return console.log("Entry data:",c),{id:l.id,...c}});r.sort((l,c)=>(c.createdAt||0)-(l.createdAt||0)),D(r),w(null),r.length>0&&o.success(`Loaded ${r.length} entries`)}catch(s){console.error("Error fetching entries:",s),w(s.message),n(`Error: ${s.message}`),o.error("Failed to load entries: "+s.message)}}async function I(s){if(s.preventDefault(),!d.trim()){o.error("Please write something first!");return}N(!0),n("Saving entry...");try{const t=new Date().toISOString().split("T")[0],r={userId:i.uid,date:t,mood:p,content:d.trim(),tags:b.split(",").map(c=>c.trim()).filter(Boolean),createdAt:Date.now()};console.log("Saving entry:",r);const l=await J(E(h,"journal_entries"),r);console.log("Entry saved with ID:",l.id),n(`Entry saved! ID: ${l.id}`),o.success("Journal entry saved! ðŸ“"),g(""),f(""),await u()}catch(t){console.error("Error saving entry:",t),n(`Save error: ${t.message}`),o.error("Failed to save: "+t.message)}finally{N(!1)}}async function k(s){try{await O(W(h,"journal_entries",s)),o.success("Entry deleted"),await u()}catch(t){console.error("Error deleting entry:",t),o.error("Failed to delete: "+t.message)}}const S=m.filter(s=>s.content?.toLowerCase().includes(x.toLowerCase())||s.tags?.some(t=>t.toLowerCase().includes(x.toLowerCase())));return e.jsxs("section",{className:"mx-auto max-w-7xl px-4 py-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Journal"}),v&&e.jsx("div",{className:"glass p-4 rounded-xl mb-6 border border-yellow-500/30 bg-yellow-500/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"text-yellow-500 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-500 font-semibold mb-1",children:"Debug Info:"}),e.jsx("p",{className:"text-sm text-zinc-400",children:v}),e.jsxs("p",{className:"text-xs text-zinc-500 mt-2",children:["User ID: ",i?.uid]}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Entries count: ",m.length]})]})]})}),y&&e.jsx("div",{className:"glass p-4 rounded-xl mb-6 border border-red-500/30 bg-red-500/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"text-red-500 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-500 font-semibold mb-1",children:"Firebase Error:"}),e.jsx("p",{className:"text-sm text-zinc-400",children:y}),e.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"This might be a permissions or index issue. Check Firebase Console."})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass p-6 rounded-2xl",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"New Entry"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"How are you feeling? *"}),e.jsx("select",{value:p,onChange:s=>C(s.target.value),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-brand-400 focus:outline-none",required:!0,children:M.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["What's on your mind? *",e.jsxs("span",{className:"text-xs text-zinc-500 ml-2",children:[d.length,"/500"]})]}),e.jsx("textarea",{value:d,onChange:s=>g(s.target.value),className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-brand-400 focus:outline-none min-h-[150px]",placeholder:"Write your thoughts...",maxLength:500,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tags (comma-separated)"}),e.jsx("input",{type:"text",value:b,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-brand-400 focus:outline-none",placeholder:"productivity, goals, reflection"})]}),e.jsx("button",{type:"submit",disabled:j||!d.trim(),className:"w-full btn-primary py-3 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Saving...":"Save Entry"})]})]}),e.jsxs("div",{className:"glass p-6 rounded-2xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-xl font-semibold",children:["Your Entries (",m.length,")"]})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:18}),e.jsx("input",{type:"text",value:x,onChange:s=>F(s.target.value),placeholder:"Search entries...",className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:ring-2 focus:ring-brand-400 focus:outline-none text-sm"})]}),e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:S.length===0?e.jsx("div",{className:"glass p-6 rounded-2xl text-center text-zinc-400",children:m.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2",children:"No entries yet."}),e.jsx("p",{className:"text-sm",children:"Write your first entry to get started! â†’"})]}):e.jsxs("p",{children:['No entries match "',x,'"']})}):S.map(s=>e.jsxs("div",{className:"glass p-5 rounded-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{size:16,className:"text-zinc-400"}),e.jsx("span",{className:"text-sm text-zinc-400",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown date"}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-brand-400/20 text-brand-400 text-xs",children:s.mood||"Unknown"})]}),e.jsx("button",{onClick:()=>k(s.id),className:"p-1 hover:bg-red-500/20 rounded-lg transition",title:"Delete entry",children:e.jsx(_,{size:16,className:"text-red-400"})})]}),e.jsx("p",{className:"text-zinc-200 mb-3 whitespace-pre-wrap",children:s.content||"No content"}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((t,r)=>e.jsxs("span",{className:"px-2 py-1 rounded-md bg-white/5 text-xs text-zinc-400",children:["#",t]},r))})]},s.id))})]})]})]})}export{Y as default};
