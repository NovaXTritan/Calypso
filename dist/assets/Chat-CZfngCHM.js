import{c as E,w as z,C as U,a as k,r as t,j as e,a5 as L,E as j}from"./index-CrkXj5Pf.js";import{A as x}from"./Avatar-BT8Fqc4U.js";import{a as A,m as C,f as I,b as M,c as T}from"./chat-VpU7-JHb.js";import{A as V,S as $}from"./send-DeZiNyi9.js";const D=E("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function B(){const{chatId:a}=z(),d=U(),{currentUser:i}=k(),[m,v]=t.useState(null),[o,y]=t.useState([]),[l,h]=t.useState(""),[u,f]=t.useState(!1),[w,N]=t.useState(!0),p=t.useRef(null),b=t.useRef(null);t.useEffect(()=>{if(!a)return;async function s(){const r=await M(a);r?v(r):(j.error("Conversation not found"),d("/matches")),N(!1)}s()},[a,d]),t.useEffect(()=>{if(!a)return;const s=A(a,r=>{y(r)});return()=>s()},[a]),t.useEffect(()=>{a&&i?.uid&&o.length>0&&C(a,i.uid)},[a,i?.uid,o.length]),t.useEffect(()=>{p.current?.scrollIntoView({behavior:"smooth"})},[o]);const g=m?.participants?.find(s=>s!==i?.uid),n=g?m?.participantData?.[g]:null;async function R(s){if(s.preventDefault(),!(!l.trim()||u)){f(!0);try{await T(a,i.uid,l),h(""),b.current?.focus()}catch(r){console.error("Error sending message:",r),j.error("Failed to send message")}finally{f(!1)}}}return w?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-brand-500/20 border-t-brand-500 animate-spin"})}):e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] md:h-[calc(100vh-80px)]",children:[e.jsxs("header",{className:"flex items-center gap-3 px-4 py-3 bg-night-900/80 backdrop-blur border-b border-white/10",children:[e.jsx("button",{onClick:()=>d("/matches"),className:"p-2 hover:bg-white/10 rounded-xl transition",children:e.jsx(V,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(x,{user:{photoURL:n?.photoURL,displayName:n?.name},size:"sm"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:n?.name||"User"}),e.jsx("p",{className:"text-xs text-zinc-400",children:"Active now"})]})]}),e.jsx("button",{className:"p-2 hover:bg-white/10 rounded-xl transition",children:e.jsx(D,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-brand-500/20 flex items-center justify-center mb-4",children:e.jsx(x,{user:{photoURL:n?.photoURL,displayName:n?.name},size:"lg"})}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:n?.name}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Start the conversation! Say hello."})]}):e.jsxs(e.Fragment,{children:[o.map((s,r)=>{const c=s.senderId===i?.uid,S=r===0||o[r-1]?.senderId!==s.senderId;return e.jsxs(L.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex items-end gap-2 ${c?"flex-row-reverse":""}`,children:[!c&&S?e.jsx(x,{user:{photoURL:n?.photoURL,displayName:n?.name},size:"xs"}):c?null:e.jsx("div",{className:"w-6"}),e.jsxs("div",{className:`max-w-[75%] px-4 py-2 rounded-2xl ${c?"bg-brand-500 text-white rounded-br-sm":"bg-white/10 text-white rounded-bl-sm"}`,children:[e.jsx("p",{className:"break-words",children:s.text}),e.jsx("p",{className:`text-[10px] mt-1 ${c?"text-white/70":"text-zinc-500"}`,children:I(s.timestamp)})]})]},s.id)}),e.jsx("div",{ref:p})]})}),e.jsxs("form",{onSubmit:R,className:"flex items-center gap-2 px-4 py-3 bg-night-900/80 backdrop-blur border-t border-white/10 safe-bottom",children:[e.jsx("input",{ref:b,type:"text",value:l,onChange:s=>h(s.target.value),placeholder:"Type a message...",className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-brand-500/50",disabled:u}),e.jsx("button",{type:"submit",disabled:!l.trim()||u,className:"p-3 bg-brand-500 hover:bg-brand-400 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl transition",children:e.jsx($,{size:20})})]})]})}export{B as default};
