import{c as M,r,a as Pe,g as pe,d as W,b as F,e as Be,f as qe,h as Ue,i as Je,k as se,l as me,m as X,n as V,o as Ge,j as e,X as Oe,q as fe,t as oe,H as _e,R as Ve,v as ze,w as He,x as ge,y as ie,z as be,A as ye,B as we,L as le,U as We}from"./index-CrkXj5Pf.js";import{L as Ye}from"./lock-_3AXRtUS.js";import{C as ae}from"./circle-alert-JXPpvSJj.js";import{U as Qe}from"./upload-BRZd2zSQ.js";import{S as Ae,A as Xe}from"./send-DeZiNyi9.js";import{F as De,T as ce}from"./trending-up-Vq24Oeey.js";import{M as Ze}from"./message-circle-CzO6Ds0t.js";import{E as Ke,C as et}from"./external-link-CW3Hc4C5.js";const je=M("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);const tt=M("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const st=M("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);const rt=M("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const at=M("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const nt=M("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const ot=M("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Ne=M("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const it=M("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const lt=M("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);const ct=M("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);let ue=t=>t;try{ue=require("dompurify").sanitize}catch{ue=t=>typeof t!="string"?"":t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}const K={success:t=>{try{require("react-hot-toast").default.success(t)}catch{console.log("Success:",t)}},error:t=>{try{require("react-hot-toast").default.error(t)}catch{console.error("Error:",t)}}},_=(t,s="")=>{if(t==null)return s;if(typeof t=="string")return t;try{return String(t)}catch{return s}},ve=(t,s=0)=>{if(typeof t=="number"&&!isNaN(t))return t;const c=Number(t);return isNaN(c)?s:c},dt=t=>{try{const s=new URL(t);return s.protocol==="http:"||s.protocol==="https:"}catch{return!1}},mt=t=>{if(!t)return{valid:!1,error:"No file selected"};if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))return{valid:!1,error:"Please select a valid image (JPEG, PNG, GIF, or WebP)"};const c=5*1024*1024;return t.size>c?{valid:!1,error:"Image must be less than 5MB"}:{valid:!0,error:null}},ut=[{id:"text",icon:ct,label:"Text"},{id:"link",icon:nt,label:"Link"},{id:"image",icon:at,label:"Image"}];function ht({podSlug:t="",podName:s="",threadId:c=null,threadTitle:g=null,onSuccess:L}){let l=null;try{l=Pe()?.currentUser}catch{console.warn("Auth context not available")}const v=r.useRef(null),[y,U]=r.useState("text"),[N,S]=r.useState(""),[P,z]=r.useState("public"),[x,J]=r.useState(!1),[B,T]=r.useState(null),[C,D]=r.useState(null),[p,i]=r.useState(null),A=r.useCallback(async()=>{if(!l?.uid)return null;try{const a=await pe(W(F,"users",l.uid));if(a.exists())return a.data()}catch(a){console.warn("Error fetching user profile:",a)}return null},[l?.uid]),I=r.useCallback(a=>{i(null);try{const f=a?.target?.files?.[0];if(!f)return;const m=mt(f);if(!m.valid){i(m.error),K.error(m.error);return}D(f);const j=new FileReader;j.onload=u=>{try{T(u.target.result)}catch{i("Failed to preview image")}},j.onerror=()=>{i("Failed to read image file")},j.readAsDataURL(f)}catch(f){console.error("Image select error:",f),i("Failed to select image")}},[]),$=r.useCallback(async()=>{if(!C||!l?.uid)return null;try{const a=Date.now(),f=C.name.replace(/[^a-zA-Z0-9.-]/g,"_").slice(0,50),m=Be(qe,`proofs/${l.uid}/${a}_${f}`);return await Ue(m,C),Je(m)}catch(a){throw console.error("Upload error:",a),new Error("Failed to upload image")}},[C,l?.uid]),G=r.useCallback(async()=>{if(!l?.uid)return 1;try{const a=await pe(W(F,"users",l.uid));if(!a.exists())return 1;const f=a.data(),m=f.lastProofDate;if(!m)return 1;const j=m.toDate?m.toDate():new Date(m),u=new Date;j.setHours(0,0,0,0),u.setHours(0,0,0,0);const O=Math.floor((u-j)/(1e3*60*60*24));return O===0?ve(f.streak,1):O===1?ve(f.streak,0)+1:1}catch(a){return console.warn("Streak calculation error:",a),1}},[l?.uid]),o=r.useCallback(()=>{if(!l?.uid)return{valid:!1,error:"Please sign in to post"};if(!t)return{valid:!1,error:"Pod information missing"};if(y==="text"){const a=N.trim();if(!a)return{valid:!1,error:"Please write something"};if(a.length>2e3)return{valid:!1,error:"Text is too long (max 2000 characters)"}}if(y==="link"){const a=N.trim();if(!a)return{valid:!1,error:"Please enter a URL"};if(!dt(a))return{valid:!1,error:"Please enter a valid URL (http:// or https://)"}}return y==="image"&&!C?{valid:!1,error:"Please select an image"}:{valid:!0,error:null}},[l?.uid,t,y,N,C]),b=r.useCallback(async a=>{if(a?.preventDefault&&a.preventDefault(),x)return;i(null);const f=o();if(!f.valid){i(f.error),K.error(f.error);return}J(!0);try{const m=await A();let j="";if(y==="image"){if(j=await $(),!j)throw new Error("Failed to upload image")}else j=ue(N.trim());const u=await G(),O={authorId:l.uid,authorName:_(m?.name||m?.displayName||l.displayName,"Anonymous"),authorAvatar:_(m?.photoURL||l.photoURL,""),podSlug:_(t),podName:_(s),threadId:c?_(c):null,threadTitle:g?_(g):null,type:y,content:j,visibility:P,likes:[],comments:[],streak:u,createdAt:Date.now(),createdAtServer:se()};if(await me(X(F,"proofs"),O),V(W(F,"users",l.uid),{totalProofs:Ge(1),streak:u,lastProofDate:se()}).catch(Y=>console.warn("Stats update failed:",Y)),S(""),T(null),D(null),U("text"),i(null),v.current&&(v.current.value=""),K.success("Proof posted! ðŸŽ‰"),typeof L=="function")try{L()}catch{}}catch(m){console.error("Post error:",m);const j=m?.message||"Failed to post. Please try again.";i(j),K.error(j)}finally{J(!1)}},[x,o,A,y,$,N,G,l,t,s,c,g,P,L]),w=r.useCallback(()=>{S(""),T(null),D(null),i(null),v.current&&(v.current.value="")},[]),d=r.useCallback(a=>{U(a),i(null),a!=="image"&&(T(null),D(null),v.current&&(v.current.value=""))},[]);return l?e.jsxs("div",{className:"glass p-5 rounded-xl border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Share Your Progress"}),e.jsx("button",{type:"button",onClick:()=>z(a=>a==="public"?"private":"public"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-all ${P==="public"?"bg-brand-500/20 text-brand-400":"bg-zinc-700/50 text-zinc-400"}`,disabled:x,children:P==="public"?e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{children:"Public"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Private"})]})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:ut.map(({id:a,icon:f,label:m})=>e.jsxs("button",{type:"button",onClick:()=>d(a),disabled:x,className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all disabled:opacity-50 ${y===a?"bg-brand-500 text-white":"bg-white/5 text-zinc-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:m})]},a))}),p&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400",children:[e.jsx(ae,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:p})]}),y==="text"&&e.jsxs("div",{children:[e.jsx("textarea",{value:N,onChange:a=>{S(a.target.value),i(null)},placeholder:"What did you accomplish? Share your progress...",className:"w-full h-32 bg-white/5 border border-white/10 focus:border-brand-500 rounded-lg px-4 py-3 text-white placeholder-zinc-500 focus:outline-none resize-none transition-colors disabled:opacity-50",maxLength:2e3,disabled:x}),e.jsxs("div",{className:"text-right text-xs text-zinc-500 mt-1",children:[N.length,"/2000"]})]}),y==="link"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"url",value:N,onChange:a=>{S(a.target.value),i(null)},placeholder:"https://...",className:"w-full bg-white/5 border border-white/10 focus:border-brand-500 rounded-lg px-4 py-3 text-white placeholder-zinc-500 focus:outline-none transition-colors disabled:opacity-50",disabled:x}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Share a link to your work: GitHub, Figma, blog post, etc."})]}),y==="image"&&e.jsxs("div",{className:"space-y-3",children:[B?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:B,alt:"Preview",className:"w-full max-h-64 object-cover rounded-lg",onError:()=>{T(null),D(null),i("Image preview failed")}}),e.jsx("button",{type:"button",onClick:w,disabled:x,className:"absolute top-2 right-2 p-1.5 bg-black/50 hover:bg-black/70 rounded-full transition-colors disabled:opacity-50",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})})]}):e.jsxs("button",{type:"button",onClick:()=>v.current?.click(),disabled:x,className:"w-full h-40 border-2 border-dashed border-white/20 hover:border-brand-500/50 rounded-lg flex flex-col items-center justify-center gap-3 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Qe,{className:"w-8 h-8 text-zinc-500"}),e.jsx("span",{className:"text-sm text-zinc-400",children:"Click to upload an image"}),e.jsx("span",{className:"text-xs text-zinc-500",children:"JPEG, PNG, GIF, WebP â€¢ Max 5MB"})]}),e.jsx("input",{ref:v,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:I,className:"hidden",disabled:x})]}),g&&e.jsxs("div",{className:"px-3 py-2 bg-white/5 rounded-lg text-sm",children:[e.jsx("span",{className:"text-zinc-400",children:"Posting in: "}),e.jsx("span",{className:"text-white",children:g})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("p",{className:"text-xs text-zinc-500",children:P==="public"?"ðŸ‘€ Visible to all pod members":"ðŸ”’ Only visible to you"}),e.jsx("button",{type:"submit",disabled:x||y!=="image"&&!N.trim()||y==="image"&&!C,className:"flex items-center gap-2 px-5 py-2.5 bg-brand-500 hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg text-white font-medium transition-colors",children:x?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Posting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Post Proof"})]})})]})]})]}):e.jsx("div",{className:"glass p-5 rounded-xl border border-white/10 text-center",children:e.jsx("p",{className:"text-zinc-400",children:"Please sign in to share your progress"})})}const xt=r.memo(ht);let he=t=>t;try{he=require("dompurify").sanitize}catch{he=t=>typeof t!="string"?"":t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}const E={success:t=>{try{require("react-hot-toast").default.success(t)}catch{console.log("Toast:",t)}},error:t=>{try{require("react-hot-toast").default.error(t)}catch{console.error("Toast Error:",t)}}},k=(t,s="")=>{if(t==null)return s;if(typeof t=="string")return t;try{return String(t)}catch{return s}},de=(t,s,c)=>{try{return k(t).slice(s,c)}catch{return""}},ke=(t,s)=>{try{return k(t).charAt(s)||""}catch{return""}},re=t=>Array.isArray(t)?t:[],pt=(t,s)=>{try{return re(t).includes(s)}catch{return!1}},Ce=t=>{try{return re(t).length}catch{return 0}},H=(t,s=0)=>{if(typeof t=="number"&&!isNaN(t))return t;const c=Number(t);return isNaN(c)?s:c},Se=t=>{try{if(!t)return"";const s=H(t);if(s<=0)return"";const g=Date.now()-s;if(g<0)return"just now";const L=Math.floor(g/6e4),l=Math.floor(g/36e5),v=Math.floor(g/864e5);return L<1?"just now":L<60?`${L}m`:l<24?`${l}h`:v<7?`${v}d`:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}},ft=t=>{try{return new URL(t),!0}catch{return!1}};function gt({proof:t,currentUserId:s,showPodBadge:c=!1}){if(!t||typeof t!="object")return null;const[g,L]=r.useState(!1),[l,v]=r.useState(""),[y,U]=r.useState(!1),[N,S]=r.useState(!1),[P,z]=r.useState(!1),[x,J]=r.useState(!1),[B,T]=r.useState(!1),[C,D]=r.useState(null),p=k(t.id),i=k(t.authorId),A=k(t.authorName,"Anonymous"),I=k(t.authorAvatar),$=k(t.podSlug),G=k(t.podName),o=k(t.threadId),b=k(t.threadTitle),w=k(t.type,"text"),d=k(t.content),a=H(t.streak,0),f=H(t.createdAt,0),m=re(t.likes),j=re(t.comments),u=pt(m,s),O=Ce(m),Y=Ce(j),Le=r.useCallback(async()=>{if(!y){if(!s){E.error("Please sign in to like");return}if(!p){console.error("Cannot like: missing proof ID");return}U(!0),D(null);try{const n=W(F,"proofs",p);u?await V(n,{likes:fe(s)}):(await V(n,{likes:oe(s)}),i&&i!==s&&me(X(F,"notifications"),{userId:i,type:"like",message:"Someone liked your proof!",proofId:p,fromUserId:s,read:!1,createdAt:se()}).catch(h=>console.warn("Notification failed:",h)))}catch(n){console.error("Error toggling like:",n),D("Failed to like"),E.error("Failed to like. Try again.")}finally{U(!1)}}},[y,s,p,u,i]),$e=r.useCallback(async n=>{n&&n.preventDefault&&n.preventDefault();const h=l.trim();if(!(!h||N)){if(!s){E.error("Please sign in to comment");return}if(!p){console.error("Cannot comment: missing proof ID");return}S(!0),D(null);try{const q=he(h),ne=W(F,"proofs",p),Q={id:`comment_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,authorId:s,authorName:"You",content:q,createdAt:Date.now()};await V(ne,{comments:oe(Q)}),i&&i!==s&&me(X(F,"notifications"),{userId:i,type:"comment",message:`Someone commented: "${de(q,0,50)}..."`,proofId:p,fromUserId:s,read:!1,createdAt:se()}).catch(Z=>console.warn("Notification failed:",Z)),v(""),E.success("Comment added!")}catch(q){console.error("Error adding comment:",q),D("Failed to comment"),E.error("Failed to comment. Try again.")}finally{S(!1)}}},[l,N,s,p,i]),Ee=r.useCallback(async()=>{try{const n=`${window.location.origin}/proof/${p}`;if(navigator.share)try{await navigator.share({title:"Check out this proof on Cosmos",text:de(d,0,100),url:n});return}catch(h){if(h.name==="AbortError")return}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(n),E.success("Link copied!");else{const h=document.createElement("textarea");h.value=n,h.style.position="fixed",h.style.left="-999999px",document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h),E.success("Link copied!")}}catch(n){console.error("Share failed:",n),E.error("Could not share")}},[p,d]),xe=r.useCallback(async()=>{if(!s){E.error("Please sign in to bookmark");return}try{const n=W(F,"users",s);x?(await V(n,{bookmarks:fe(p)}),J(!1),E.success("Removed from bookmarks")):(await V(n,{bookmarks:oe(p)}),J(!0),E.success("Bookmarked!"))}catch(n){console.error("Error bookmarking:",n)}},[s,p,x]),Fe=()=>{try{switch(w){case"link":return!d||!ft(d)?e.jsx("p",{className:"text-zinc-400 italic",children:"Invalid link"}):e.jsxs("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-brand-400 hover:text-brand-300 transition-colors group",children:[e.jsx(Ke,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"underline break-all group-hover:no-underline",children:d.length>60?de(d,0,60)+"...":d})]});case"image":return d?B?e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-white/5 rounded-lg text-zinc-400",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Image could not be loaded"})]}):e.jsx("div",{className:"relative group",children:e.jsx("img",{src:d,alt:"Proof",className:"rounded-lg max-h-96 w-full object-cover cursor-pointer hover:opacity-95 transition-opacity",onClick:()=>{try{window.open(d,"_blank")}catch{}},onError:()=>T(!0),loading:"lazy"})}):e.jsx("p",{className:"text-zinc-400 italic",children:"Image not available"});default:return e.jsx("p",{className:"text-zinc-200 whitespace-pre-wrap leading-relaxed break-words",children:d||e.jsx("span",{className:"text-zinc-500 italic",children:"No content"})})}}catch(n){return console.error("Error rendering content:",n),e.jsx("p",{className:"text-zinc-400 italic",children:"Content could not be displayed"})}},Me=()=>{try{return[...j].sort((h,q)=>H(q?.createdAt,0)-H(h?.createdAt,0)).map((h,q)=>{if(!h||typeof h!="object")return null;const ne=k(h.id,`fallback_${q}`),Q=k(h.authorId),Z=k(h.authorName,"Anonymous"),Te=k(h.content),Ie=H(h.createdAt);return e.jsxs("div",{className:"flex gap-3 group",children:[e.jsx("a",{href:Q?`/profile/${Q}`:"#",className:"shrink-0",onClick:Re=>!Q&&Re.preventDefault(),children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-zinc-600 to-zinc-700 flex items-center justify-center text-xs text-white font-medium",children:ke(Z,0).toUpperCase()||"?"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"bg-white/5 rounded-lg rounded-tl-none p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:Z}),e.jsx("span",{className:"text-xs text-zinc-500",children:Se(Ie)})]}),e.jsx("p",{className:"text-sm text-zinc-300 break-words",children:Te})]})})]},ne)}).filter(Boolean)}catch(n){return console.error("Error rendering comments:",n),null}};return e.jsxs("div",{className:"glass p-5 rounded-xl border border-white/10 hover:border-white/20 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsxs("a",{href:i?`/profile/${i}`:"#",className:"shrink-0",onClick:n=>!i&&n.preventDefault(),children:[I?e.jsx("img",{src:I,alt:"",className:"w-11 h-11 rounded-full object-cover ring-2 ring-white/10 hover:ring-brand-500/50 transition-all",onError:n=>{n.target.style.display="none",n.target.nextSibling&&(n.target.nextSibling.style.display="flex")}}):null,e.jsx("div",{className:`w-11 h-11 rounded-full bg-gradient-to-br from-brand-500 to-glow-500 items-center justify-center text-white font-bold text-lg ring-2 ring-white/10 hover:ring-brand-500/50 transition-all ${I?"hidden":"flex"}`,children:ke(A,0).toUpperCase()||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("a",{href:i?`/profile/${i}`:"#",className:"font-semibold text-white hover:text-brand-400 transition-colors truncate",onClick:n=>!i&&n.preventDefault(),children:A}),a>=3&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-orange-500/20 rounded-full text-xs text-orange-300",children:[e.jsx(De,{className:"w-3 h-3"}),a]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[e.jsx("span",{children:Se(f)}),c&&G&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("a",{href:$?`/pods/${$}`:"#",className:"text-brand-400 hover:text-brand-300 transition-colors truncate",onClick:n=>!$&&n.preventDefault(),children:G})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>z(!P),className:"p-2 hover:bg-white/5 rounded-lg text-zinc-400 hover:text-white transition-all","aria-label":"More options",children:e.jsx(tt,{className:"w-5 h-5"})}),P&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>z(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-40 bg-zinc-800 border border-white/10 rounded-lg shadow-xl z-20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{xe(),z(!1)},className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-zinc-300 hover:bg-white/5 transition-colors",children:[e.jsx(je,{className:`w-4 h-4 ${x?"fill-current text-brand-400":""}`}),x?"Bookmarked":"Bookmark"]}),e.jsxs("button",{onClick:()=>z(!1),className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-zinc-300 hover:bg-white/5 transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Report"]})]})]})]})]}),e.jsx("div",{className:"mb-4",children:Fe()}),b&&e.jsxs("a",{href:$&&o?`/pods/${$}/thread/${o}`:"#",className:"block mb-4 px-3 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-sm text-zinc-400 transition-colors",onClick:n=>(!$||!o)&&n.preventDefault(),children:["ðŸ’¬ in thread: ",e.jsx("span",{className:"text-zinc-300",children:b})]}),C&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-red-500/10 border border-red-500/20 rounded-lg text-sm text-red-400",children:C}),e.jsxs("div",{className:"flex items-center gap-1 pt-3 border-t border-white/10",children:[e.jsxs("button",{onClick:Le,disabled:y,className:`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all disabled:opacity-50 ${u?"bg-pink-500/20 text-pink-400":"hover:bg-white/5 text-zinc-400 hover:text-pink-400"}`,"aria-label":u?"Unlike":"Like",children:[e.jsx(_e,{className:`w-5 h-5 ${u?"fill-current":""}`}),O>0&&e.jsx("span",{className:"text-sm font-medium",children:O})]}),e.jsxs("button",{onClick:()=>L(!g),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg transition-all ${g?"bg-brand-500/20 text-brand-400":"hover:bg-white/5 text-zinc-400 hover:text-brand-400"}`,"aria-label":"Comments",children:[e.jsx(Ze,{className:"w-5 h-5"}),Y>0&&e.jsx("span",{className:"text-sm font-medium",children:Y})]}),e.jsx("button",{onClick:Ee,className:"flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-white/5 text-zinc-400 hover:text-glow-400 transition-all","aria-label":"Share",children:e.jsx(lt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:xe,className:`ml-auto p-2 rounded-lg transition-all ${x?"bg-brand-500/20 text-brand-400":"hover:bg-white/5 text-zinc-400 hover:text-brand-400"}`,"aria-label":x?"Remove bookmark":"Bookmark",children:e.jsx(je,{className:`w-5 h-5 ${x?"fill-current":""}`})})]}),g&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 space-y-4",children:[e.jsxs("form",{onSubmit:$e,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:n=>v(n.target.value),placeholder:"Add a comment...",className:"flex-1 bg-white/5 border border-white/10 focus:border-brand-500 rounded-lg px-4 py-2.5 text-white placeholder-zinc-500 focus:outline-none transition-colors",maxLength:500,disabled:N}),e.jsx("button",{type:"submit",disabled:!l.trim()||N,className:"px-4 py-2.5 bg-brand-500 hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-colors","aria-label":"Send comment",children:e.jsx(Ae,{className:"w-5 h-5 text-white"})})]}),Y>0?e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:Me()}):e.jsx("p",{className:"text-sm text-zinc-500 text-center py-4",children:"No comments yet. Start the conversation!"})]})]})}const bt=r.memo(gt),yt=[{slug:"dsa",name:"DSA & Algorithms",description:"Data structures and algorithmic problem solving"},{slug:"webdev",name:"Web Development",description:"Frontend, backend, and full-stack development"},{slug:"ai-ml",name:"AI & Machine Learning",description:"Artificial intelligence and machine learning"},{slug:"placement",name:"Placement Prep",description:"Interview preparation and career guidance"},{slug:"open-source",name:"Open Source",description:"Contributing to open source projects"},{slug:"entrepreneurship",name:"Entrepreneurship",description:"A community for learning and growing together"}],R=(t,s="")=>{if(t==null)return s;if(typeof t=="string")return t;try{return String(t)}catch{return s}},ee=(t,s=0)=>{if(typeof t=="number"&&!isNaN(t))return t;const c=Number(t);return isNaN(c)?s:c},te=t=>Array.isArray(t)?t:[];class wt extends Ve.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,c){console.error("PodForum Error:",s,c)}render(){return this.state.hasError?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"glass p-8 rounded-xl text-center",children:[e.jsx(ae,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-zinc-400 mb-4",children:"We couldn't load this page properly."}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-500 hover:bg-brand-600 rounded-lg text-white transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),"Reload Page"]})]})}):this.props.children}}const jt=r.memo(()=>e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"glass p-5 rounded-xl animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-zinc-700"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("div",{className:"h-4 w-32 bg-zinc-700 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-zinc-800 rounded"})]})]}),e.jsx("div",{className:"h-24 bg-zinc-800 rounded"})]},t))})),Nt=r.memo(({isMember:t,podName:s})=>e.jsxs("div",{className:"glass p-8 rounded-xl text-center",children:[e.jsx("p",{className:"text-zinc-400 mb-2",children:"No proofs in this pod yet"}),e.jsx("p",{className:"text-sm text-zinc-500",children:t?"Be the first to share your progress!":`Join ${s||"this pod"} to start sharing`})]})),vt=r.memo(({message:t,onRetry:s})=>e.jsxs("div",{className:"glass p-6 rounded-xl border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ae,{className:"w-6 h-6 text-red-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"Error Loading Content"})]}),e.jsx("p",{className:"text-zinc-400 mb-4",children:t}),s&&e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-white transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),"Try Again"]})]}));function kt(){const{slug:t}=He(),{currentUser:s,updateUserProfile:c}=Pe(),[g,L]=r.useState("feed"),[l,v]=r.useState([]),[y,U]=r.useState([]),[N,S]=r.useState(!0),[P,z]=r.useState(null),[x,J]=r.useState("recent"),[B,T]=r.useState({members:0,proofs:0,activeToday:0}),[C,D]=r.useState(!1),p=yt.find(o=>o.slug===t)||{name:t?.charAt(0).toUpperCase()+t?.slice(1)||"Pod",description:"A community for learning and growing together"},A=te(s?.joinedPods).includes(t);r.useEffect(()=>{if(!t){S(!1);return}S(!0),z(null);let o=()=>{};try{const b=ge(X(F,"proofs"),ie("podSlug","==",t),ie("visibility","==","public"),be("createdAt","desc"),ye(50));o=we(b,w=>{try{const d=w.docs.map(u=>({id:u.id,...u.data()}));v(d);const a=new Date;a.setHours(0,0,0,0);const f=a.getTime(),m=new Set(d.map(u=>R(u?.authorId)).filter(Boolean)),j=d.filter(u=>ee(u?.createdAt,0)>=f);T(u=>({...u,proofs:d.length,activeToday:j.length,members:Math.max(u.members,m.size)})),S(!1),z(null)}catch(d){console.error("Error processing proofs:",d),z("Failed to process activity data"),S(!1)}},w=>{console.error("Firestore error:",w),w?.code==="failed-precondition"?z("Database indexes are being built. Please try again in a few minutes."):w?.code==="permission-denied"?z("You don't have permission to view this content."):z("Failed to load activity. Please try again."),S(!1)})}catch(b){console.error("Query setup error:",b),z("Failed to connect to database"),S(!1)}return()=>{try{o()}catch{}}},[t]),r.useEffect(()=>{if(!t||g!=="threads")return;let o=()=>{};try{const b=ge(X(F,"threads"),ie("podSlug","==",t),be("updatedAt","desc"),ye(20));o=we(b,w=>{U(w.docs.map(d=>({id:d.id,...d.data()})))},w=>{console.warn("Threads fetch error:",w)})}catch(b){console.warn("Threads query error:",b)}return()=>{try{o()}catch{}}},[t,g]);const I=[...l].sort((o,b)=>{try{if(x==="popular"){const w=te(o?.likes).length;return te(b?.likes).length-w}return ee(b?.createdAt,0)-ee(o?.createdAt,0)}catch{return 0}}),$=r.useCallback(async()=>{if(!s?.uid){alert("Please sign in to join pods");return}D(!0);try{const o=te(s?.joinedPods);let b;A?b=o.filter(w=>w!==t):b=[...o,t],await c({joinedPods:b})}catch(o){console.error("Join/leave error:",o),alert("Failed to update membership. Please try again.")}finally{D(!1)}},[A,t,s,c]),G=r.useCallback(()=>{window.location.reload()},[]);return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs(le,{to:"/pods",className:"inline-flex items-center gap-2 text-zinc-400 hover:text-white mb-6 transition-colors",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Back to Pods"]}),e.jsxs("div",{className:"glass p-6 rounded-2xl mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:R(p.name,"Pod")}),e.jsx("p",{className:"text-zinc-400",children:p.description||"A community for learning and growing together"})]}),e.jsx("button",{onClick:$,disabled:C||!s,className:`px-6 py-3 rounded-lg font-medium transition-all disabled:opacity-50 ${A?"bg-zinc-700 hover:bg-zinc-600 text-white":"bg-brand-500 hover:bg-brand-600 text-white"}`,children:s?C?"Loading...":A?"Leave Pod":"Join Pod":"Sign in to Join"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-white/10",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-2xl font-bold text-white mb-1",children:[e.jsx(We,{className:"w-5 h-5 text-brand-400"}),B.members||"-"]}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Members"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-2xl font-bold text-white mb-1",children:[e.jsx(ce,{className:"w-5 h-5 text-glow-400"}),B.proofs]}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Proofs"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-2xl font-bold text-white mb-1",children:[e.jsx(De,{className:"w-5 h-5 text-orange-400"}),B.activeToday]}),e.jsx("p",{className:"text-sm text-zinc-400",children:"Today"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>L("feed"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-all ${g==="feed"?"bg-brand-500 text-white":"bg-white/5 text-zinc-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(ce,{className:"w-5 h-5"}),"Activity Feed"]}),e.jsxs("button",{onClick:()=>L("threads"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg transition-all ${g==="threads"?"bg-brand-500 text-white":"bg-white/5 text-zinc-400 hover:bg-white/10 hover:text-white"}`,children:[e.jsx(Ne,{className:"w-5 h-5"}),"Threads"]})]}),g==="feed"?e.jsxs("div",{className:"space-y-6",children:[A&&e.jsx(xt,{podSlug:t,podName:R(p.name),onSuccess:()=>{}}),!A&&e.jsxs("div",{className:"glass p-6 rounded-xl text-center border border-dashed border-white/20",children:[e.jsx("p",{className:"text-zinc-400 mb-3",children:s?"Join this pod to share your progress":"Sign in and join this pod to share your progress"}),e.jsx("button",{onClick:$,disabled:C||!s,className:"px-6 py-2 bg-brand-500 hover:bg-brand-600 rounded-lg text-white transition-colors disabled:opacity-50",children:s?C?"Loading...":`Join ${R(p.name,"Pod")}`:"Sign in to Join"})]}),P&&e.jsx(vt,{message:P,onRetry:G}),!P&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Recent Activity"}),e.jsx("div",{className:"flex gap-1 bg-white/5 rounded-lg p-1",children:[{key:"recent",icon:et,label:"Recent"},{key:"popular",icon:ce,label:"Popular"}].map(({key:o,icon:b,label:w})=>e.jsxs("button",{onClick:()=>J(o),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm transition-all ${x===o?"bg-brand-500 text-white":"text-zinc-400 hover:text-white"}`,children:[e.jsx(b,{className:"w-4 h-4"}),w]},o))})]}),N&&e.jsx(jt,{}),!N&&!P&&I.length===0&&e.jsx(Nt,{isMember:A,podName:R(p.name)}),!N&&!P&&I.length>0&&e.jsx("div",{className:"space-y-4",children:I.map(o=>e.jsx(bt,{proof:o,currentUserId:s?.uid},R(o?.id,Math.random().toString())))})]}):e.jsxs("div",{className:"space-y-4",children:[A&&e.jsxs(le,{to:`/pods/${t}/new-thread`,className:"flex items-center justify-center gap-2 w-full p-4 border-2 border-dashed border-white/20 hover:border-brand-500/50 rounded-xl text-zinc-400 hover:text-white transition-all",children:[e.jsx(it,{className:"w-5 h-5"}),"Create New Thread"]}),y.length===0?e.jsxs("div",{className:"glass p-8 rounded-xl text-center",children:[e.jsx(Ne,{className:"w-12 h-12 text-zinc-600 mx-auto mb-3"}),e.jsx("p",{className:"text-zinc-400",children:"No threads yet"})]}):y.map(o=>e.jsxs(le,{to:`/pods/${t}/thread/${R(o?.id)}`,className:"block glass p-5 rounded-xl hover:border-white/20 border border-transparent transition-all",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:R(o?.title,"Untitled Thread")}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-zinc-400",children:[e.jsxs("span",{children:[ee(o?.postCount,0)," posts"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:o?.updatedAt?new Date(o.updatedAt).toLocaleDateString():"Unknown date"})]})]},R(o?.id,Math.random().toString())))]})]})}function Et(){return e.jsx(wt,{children:e.jsx(kt,{})})}export{Et as default};
