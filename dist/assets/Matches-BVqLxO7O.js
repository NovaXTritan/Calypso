import{c as H,C as O,a as Q,r as x,D as L,m as G,b as E,E as F,j as e,U as W}from"./index-CrkXj5Pf.js";import{A as D}from"./Avatar-BT8Fqc4U.js";import{s as Y,g as B}from"./chat-VpU7-JHb.js";import{T as J}from"./target-twTTPLSF.js";import{Z as K}from"./zap-CT4i9PvB.js";import{M as C}from"./message-circle-CzO6Ds0t.js";const X=H("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function R(s,a){if(!s?.length&&!a?.length||!s?.length||!a?.length)return 0;const c=new Set(s.map(l=>l.toLowerCase().trim())),n=new Set(a.map(l=>l.toLowerCase().trim())),i=new Set([...c].filter(l=>n.has(l))),o=new Set([...c,...n]);return i.size/o.size}function _(s,a){const c=s.length,n=a.length,i=Array(c+1).fill(null).map(()=>Array(n+1).fill(0));for(let o=0;o<=c;o++)i[o][0]=o;for(let o=0;o<=n;o++)i[0][o]=o;for(let o=1;o<=c;o++)for(let l=1;l<=n;l++)s[o-1]===a[l-1]?i[o][l]=i[o-1][l-1]:i[o][l]=Math.min(i[o-1][l-1]+1,i[o-1][l]+1,i[o][l-1]+1);return i[c][n]}function ee(s,a){if(!s?.length||!a?.length)return 0;const c=m=>m.toLowerCase().trim(),n=s.map(c),i=a.map(c);let o=0,l=0;for(const m of n){let d=0;for(const h of i){if(m===h){d=1;break}if(m.includes(h)||h.includes(m)){d=Math.max(d,.8);continue}const p=Math.max(m.length,h.length),j=1-_(m,h)/p;j>.6&&(d=Math.max(d,j*.7))}o+=d,l++}return l>0?o/l:0}function te(s,a){let c=0;const n=s.streak||0;c+=Math.min(n*3,30);const i=a.filter(l=>Date.now()-l.createdAt<10080*60*1e3).length;c+=Math.min(i*8,40);const o=s.totalProofs||a.length;return c+=Math.min(o*2,30),c/100}function se(s,a){const c=s.goals||[],n=a.goals||[];if(!c.length||!n.length)return .5;const i=R(c,n);return i>=.3&&i<=.7?1:i<.3?.5+i:.8+(1-i)*.2}function ae(s,a,c){return s?(c.filter(n=>n.author===s.uid),a.filter(n=>n.uid!==s.uid).map(n=>{const i=c.filter(f=>f.author===n.uid),o=R(s.joinedPods||[],n.joinedPods||[]),l=ee(s.goals||[],n.goals||[]),m=te(n,i),d=se(s,n),h={pods:.3,goals:.35,activity:.2,complementary:.15},p=o*h.pods+l*h.goals+m*h.activity+d*h.complementary,b=(n.joinedPods||[]).filter(f=>(s.joinedPods||[]).includes(f)),j=(n.goals||[]).filter(f=>(s.goals||[]).some(v=>v.toLowerCase().includes(f.toLowerCase())||f.toLowerCase().includes(v.toLowerCase()))),y=i.filter(f=>Date.now()-f.createdAt<10080*60*1e3).length;return{...n,matchScore:Math.round(p*100),scores:{pods:Math.round(o*100),goals:Math.round(l*100),activity:Math.round(m*100),complementary:Math.round(d*100)},commonPods:b,commonGoals:j,recentActivity:y}}).sort((n,i)=>i.matchScore-n.matchScore)):[]}function ne(s){const a=[];return s.commonPods?.length>0&&a.push(`Same pods: ${s.commonPods.slice(0,2).join(", ")}`),s.commonGoals?.length>0&&a.push(`Similar goals: ${s.commonGoals.slice(0,2).join(", ")}`),s.recentActivity>3&&a.push("Very active this week"),s.scores?.complementary>80&&a.push("Great for learning together"),a.length>0?a[0]:"Potential learning partner"}function $(s){return s>=80?{label:"Excellent Match",color:"text-green-400"}:s>=60?{label:"Great Match",color:"text-brand-400"}:s>=40?{label:"Good Match",color:"text-yellow-400"}:{label:"Potential Match",color:"text-zinc-400"}}function me(){const s=O(),{currentUser:a}=Q(),[c,n]=x.useState([]),[i,o]=x.useState([]),[l,m]=x.useState(!0),[d,h]=x.useState("all"),[p,b]=x.useState("all"),[j,y]=x.useState([]),[f,v]=x.useState([]),[N,T]=x.useState([]),[M,z]=x.useState(null);x.useEffect(()=>{if(!a?.uid)return;const t=Y(a.uid,r=>{T(r)});return()=>t()},[a?.uid]);function U(t){return N.find(r=>r.participants.includes(t))}x.useEffect(()=>{I()},[a]),x.useEffect(()=>{V()},[c,d,p]);async function I(){if(a)try{const r=(await L(G(E,"users"))).docs.map(g=>({id:g.id,...g.data()})),w=(await L(G(E,"posts"))).docs.map(g=>g.data()),P=ae(a,r,w);n(P);const A=new Set,k=new Set;P.forEach(g=>{(g.joinedPods||[]).forEach(S=>A.add(S)),(g.goals||[]).forEach(S=>k.add(S))}),y(Array.from(A)),v(Array.from(k))}catch(t){console.error("Error fetching users:",t),F.error("Failed to load matches")}finally{m(!1)}}function V(){let t=[...c];d!=="all"&&(t=t.filter(r=>(r.joinedPods||[]).includes(d))),p!=="all"&&(t=t.filter(r=>(r.goals||[]).some(u=>u.toLowerCase().includes(p.toLowerCase())))),o(t)}async function Z(t){z(t.uid);try{const r=await B(a,t);s(`/chat/${r.id}`)}catch(r){console.error("Error starting chat:",r),F.error("Failed to start chat")}finally{z(null)}}function q(t){s(`/chat/${t}`)}return l?e.jsx("section",{className:"mx-auto max-w-7xl px-4 py-12",children:e.jsx("div",{className:"text-zinc-400",children:"Loading matches..."})}):e.jsxs("section",{className:"mx-auto max-w-7xl px-4 py-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Discover Peers"}),e.jsx("p",{className:"text-zinc-300 mb-8",children:"Find people with similar learning goals"}),e.jsx("div",{className:"glass p-5 rounded-2xl mb-6",children:e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Filter by Pod"}),e.jsxs("select",{value:d,onChange:t=>h(t.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400",children:[e.jsx("option",{value:"all",children:"All Pods"}),j.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Filter by Goal"}),e.jsxs("select",{value:p,onChange:t=>b(t.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400",children:[e.jsx("option",{value:"all",children:"All Goals"}),f.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}),i.length===0?e.jsx("div",{className:"glass p-8 rounded-2xl text-center text-zinc-400",children:"No matches found. Try adjusting your filters or join more pods!"}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-5",children:i.map(t=>e.jsxs("div",{className:"glass p-5 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{user:t}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.displayName||"Anonymous"}),e.jsx("div",{className:"text-xs text-zinc-400",children:ne(t)})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 rounded-full bg-brand-400/20",children:[e.jsx(X,{size:14,className:"text-brand-400"}),e.jsxs("span",{className:"text-sm font-semibold text-brand-400",children:[t.matchScore,"%"]})]}),e.jsx("span",{className:`text-[10px] ${$(t.matchScore).color}`,children:$(t.matchScore).label})]})]}),t.bio&&e.jsx("p",{className:"text-sm text-zinc-300 mb-3 line-clamp-2",children:t.bio}),t.commonPods&&t.commonPods.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-zinc-400 mb-1",children:[e.jsx(W,{size:12}),e.jsx("span",{children:"Common Pods"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.commonPods.slice(0,3).map(r=>e.jsx("span",{className:"px-2 py-1 rounded-md bg-white/10 text-xs",children:r},r)),t.commonPods.length>3&&e.jsxs("span",{className:"px-2 py-1 text-xs text-zinc-400",children:["+",t.commonPods.length-3," more"]})]})]}),t.commonGoals&&t.commonGoals.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-zinc-400 mb-1",children:[e.jsx(J,{size:12}),e.jsx("span",{children:"Common Goals"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.commonGoals.slice(0,2).map((r,u)=>e.jsx("span",{className:"px-2 py-1 rounded-md bg-white/5 text-xs text-zinc-300",children:r},u))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 mb-4",children:[e.jsx(K,{size:12}),e.jsxs("span",{children:[t.recentActivity," proofs this week"]})]}),(()=>{const r=U(t.uid);return r?e.jsxs("button",{onClick:()=>q(r.id),className:"w-full flex items-center justify-center gap-2 btn-ghost py-2 text-sm",children:[e.jsx(C,{size:14}),"Continue Chat"]}):e.jsx("button",{onClick:()=>Z(t),disabled:M===t.uid,className:"w-full flex items-center justify-center gap-2 btn-primary py-2 text-sm disabled:opacity-50",children:M===t.uid?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:14}),"Start Chat"]})})})()]},t.id))}),N.length>0&&e.jsxs("div",{className:"mt-10",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Recent Chats"}),e.jsx("div",{className:"space-y-2",children:N.slice(0,5).map(t=>{const r=t.participants.find(w=>w!==a.uid),u=t.participantData?.[r];return e.jsxs("button",{onClick:()=>s(`/chat/${t.id}`),className:"w-full flex items-center gap-3 p-4 glass rounded-xl hover:bg-white/10 transition text-left",children:[e.jsx(D,{user:{photoURL:u?.photoURL,displayName:u?.name},size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:u?.name||"User"}),t.lastMessage&&e.jsxs("p",{className:"text-sm text-zinc-400 truncate",children:[t.lastMessage.senderId===a.uid?"You: ":"",t.lastMessage.text]})]}),e.jsx(C,{size:18,className:"text-zinc-400"})]},t.id)})})]})]})}export{me as default};
