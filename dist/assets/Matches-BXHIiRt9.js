import{a as I,r as o,C as v,m as N,b as w,j as e,U as Z}from"./index-CB_rz54d.js";import{A as q,Z as y}from"./Avatar-Def0hpam.js";import{T as R}from"./target-U2_ERc0m.js";import{S as W}from"./send-bVT6y3xw.js";function O(){const{currentUser:i}=I(),[x,P]=o.useState([]),[h,S]=o.useState([]),[z,C]=o.useState(!0),[c,A]=o.useState("all"),[r,G]=o.useState("all"),[E,L]=o.useState([]),[U,F]=o.useState([]);o.useEffect(()=>{M()},[i]),o.useEffect(()=>{k()},[x,c,r]);async function M(){if(i)try{const a=(await v(N(w,"users"))).docs.map(t=>({id:t.id,...t.data()})).filter(t=>t.uid!==i.uid),D=(await v(N(w,"posts"))).docs.map(t=>t.data()),m=a.map(t=>{let l=0;const u=(t.joinedPods||[]).filter(n=>(i.joinedPods||[]).includes(n));l+=u.length/Math.max((i.joinedPods||[]).length,1)*40;const j=(t.goals||[]).filter(n=>(i.goals||[]).some(b=>b.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(b.toLowerCase())));l+=j.length/Math.max((i.goals||[]).length,1)*40;const g=D.filter(n=>n.author===t.uid).filter(n=>Date.now()-n.createdAt<10080*60*1e3);return l+=Math.min(g.length/5,1)*20,{...t,matchScore:Math.round(l),commonPods:u,commonGoals:j,recentActivity:g.length}});m.sort((t,l)=>l.matchScore-t.matchScore),P(m);const p=new Set,f=new Set;m.forEach(t=>{(t.joinedPods||[]).forEach(l=>p.add(l)),(t.goals||[]).forEach(l=>f.add(l))}),L(Array.from(p)),F(Array.from(f))}catch(s){console.error("Error fetching users:",s)}finally{C(!1)}}function k(){let s=[...x];c!=="all"&&(s=s.filter(a=>(a.joinedPods||[]).includes(c))),r!=="all"&&(s=s.filter(a=>(a.goals||[]).some(d=>d.toLowerCase().includes(r.toLowerCase())))),S(s)}async function T(s){alert(`Connection request sent! (This is a demo - full implementation would notify ${s})`)}return z?e.jsx("section",{className:"mx-auto max-w-7xl px-4 py-12",children:e.jsx("div",{className:"text-zinc-400",children:"Loading matches..."})}):e.jsxs("section",{className:"mx-auto max-w-7xl px-4 py-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Discover Peers"}),e.jsx("p",{className:"text-zinc-300 mb-8",children:"Find people with similar learning goals"}),e.jsx("div",{className:"glass p-5 rounded-2xl mb-6",children:e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Filter by Pod"}),e.jsxs("select",{value:c,onChange:s=>A(s.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400",children:[e.jsx("option",{value:"all",children:"All Pods"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Filter by Goal"}),e.jsxs("select",{value:r,onChange:s=>G(s.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400",children:[e.jsx("option",{value:"all",children:"All Goals"}),U.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}),h.length===0?e.jsx("div",{className:"glass p-8 rounded-2xl text-center text-zinc-400",children:"No matches found. Try adjusting your filters or join more pods!"}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-5",children:h.map(s=>e.jsxs("div",{className:"glass p-5 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{name:s.displayName}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.displayName}),e.jsxs("div",{className:"text-xs text-zinc-400",children:[s.joinedPods?.length||0," pods"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 rounded-full bg-brand-400/20",children:[e.jsx(y,{size:14,className:"text-brand-400"}),e.jsxs("span",{className:"text-sm font-semibold text-brand-400",children:[s.matchScore,"%"]})]})]}),s.bio&&e.jsx("p",{className:"text-sm text-zinc-300 mb-3 line-clamp-2",children:s.bio}),s.commonPods&&s.commonPods.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-zinc-400 mb-1",children:[e.jsx(Z,{size:12}),e.jsx("span",{children:"Common Pods"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.commonPods.slice(0,3).map(a=>e.jsx("span",{className:"px-2 py-1 rounded-md bg-white/10 text-xs",children:a},a)),s.commonPods.length>3&&e.jsxs("span",{className:"px-2 py-1 text-xs text-zinc-400",children:["+",s.commonPods.length-3," more"]})]})]}),s.commonGoals&&s.commonGoals.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-zinc-400 mb-1",children:[e.jsx(R,{size:12}),e.jsx("span",{children:"Common Goals"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.commonGoals.slice(0,2).map((a,d)=>e.jsx("span",{className:"px-2 py-1 rounded-md bg-white/5 text-xs text-zinc-300",children:a},d))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 mb-4",children:[e.jsx(y,{size:12}),e.jsxs("span",{children:[s.recentActivity," proofs this week"]})]}),e.jsxs("button",{onClick:()=>T(s.uid),className:"w-full flex items-center justify-center gap-2 btn-primary py-2 text-sm",children:[e.jsx(W,{size:14}),"Send Intro"]})]},s.id))})]})}export{O as default};
